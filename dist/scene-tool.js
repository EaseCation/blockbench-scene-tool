(()=>{"use strict";Plugin.register("scene-tool",{name:"Scene Tool",author:"EaseCation",description:"使用BlockBench制作场景动画的工具",version:"1.0.0",variant:"both",onload(){MenuBar.addAction(new Action("add_bone_prefix",{name:"添加/修改骨骼前缀",icon:"text_fields",click:function(){!function(){const e=Group.multi_selected;if(0===e.length)return void Blockbench.showQuickMessage("错误：请先选择至少一个骨骼！");const n=function(e){if(!e||0===e.length)return"";let n="",o=!0;return e.forEach((e=>{const i=e.name.split("@");if(i.length>1){const e=i[0];o?(n=e,o=!1):n!==e&&(n="")}else o?o=!1:n=""})),n}(e),o=new Dialog({id:"bone_prefix_dialog",title:""!==n?"修改骨骼前缀":"添加骨骼前缀",width:400,form:{prefix:{label:"前缀",type:"text",value:n}},buttons:["confirm","cancel"],onConfirm:function(n){n.prefix&&""!==n.prefix.trim()?(function(e,n){Undo.initEdit({outliner:!0});let o=0,i=0;if(e.forEach((e=>{!function e(t){if(t instanceof Group){const c=t.name.split("@");c.length>1?c[0]!==n&&(t.name=n+"@"+c.slice(1).join("@"),i++):(t.name=n+"@"+t.name,o++),t.children&&t.children.forEach((n=>{e(n)}))}}(e)})),Undo.finishEdit(`添加/修改骨骼前缀: "${n}"`),o>0||i>0){let e=`成功处理${o+i}个骨骼`;o>0&&(e+=`，新增前缀${o}个`),i>0&&(e+=`，更新前缀${i}个`),Blockbench.showQuickMessage(e)}else Blockbench.showQuickMessage("没有骨骼需要添加或修改前缀");Canvas.updateAll()}(e,n.prefix.trim()),o.hide()):Blockbench.showQuickMessage("错误：请输入有效的前缀！")}});o.show()}()}}),"tools"),function(){const e=new Action("export_animation_without_prefix",{name:"动画导出（过滤前缀)",icon:"text_fields",click:function(){!function(){if(!AnimationItem.selected)return void Blockbench.showQuickMessage("请先选择一个动画");const e=AnimationItem.selected.compileBedrockAnimation();if(!e)return void Blockbench.showQuickMessage("无法编译动画数据");const n=AnimationItem.selected.name||"animation",o=`${n}.json`;for(const n in e.bones)if(-1!==n.indexOf("@")){const o=n.split("@")[1];e.bones[o]=e.bones[n],delete e.bones[n]}const i={format_version:"1.10",animations:{[n]:e}};Blockbench.export({type:"Bedrock Animation",extensions:["json"],name:o,content:JSON.stringify(i,null,2),savetype:"text"},(e=>{e&&Blockbench.showQuickMessage(`成功导出动画到 ${e}`)}))}()}});MenuBar.addAction(e,"tools")}()}})})();