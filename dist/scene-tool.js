(()=>{"use strict";Plugin.register("scene-tool",{name:"Scene Tool",author:"EaseCation",description:"使用BlockBench制作场景动画的工具",version:"1.0.0",variant:"both",onload(){MenuBar.addAction(new Action("add_bone_prefix",{name:"添加骨骼前缀",icon:"text_fields",click:function(){!function(){const e=Group.multi_selected;if(0===e.length)return void Blockbench.showQuickMessage("错误：请先选择至少一个骨骼！");const n=new Dialog({id:"bone_prefix_dialog",title:"添加骨骼前缀",width:400,form:{prefix:{label:"前缀",type:"text"}},onConfirm:function(o){o.prefix&&""!==o.prefix.trim()?(function(e,n){Undo.initEdit({outliner:!0});let o=0;e.forEach((e=>{!function e(i){i instanceof Group&&(i.name.startsWith(n)||(i.name=n+"@"+i.name,o++),i.children&&i.children.forEach((n=>{e(n)})))}(e)})),Undo.finishEdit(`添加骨骼前缀: "${n}"`),o>0?Blockbench.showQuickMessage(`成功添加前缀"${n}"到${o}个骨骼`):Blockbench.showQuickMessage("没有骨骼需要添加前缀（可能已存在相同前缀）"),Canvas.updateAll()}(e,o.prefix.trim()),n.hide()):Blockbench.showQuickMessage("错误：请输入有效的前缀！")}});n.show()}()}}),"tools"),function(){const e=new Action("export_animation_without_prefix",{name:"动画导出（过滤前缀)",icon:"text_fields",click:function(){!function(){if(!AnimationItem.selected)return void Blockbench.showQuickMessage("请先选择一个动画");const e=AnimationItem.selected.compileBedrockAnimation();if(!e)return void Blockbench.showQuickMessage("无法编译动画数据");const n=AnimationItem.selected.name||"animation",o=`${n}.json`;for(const n in e.bones)if(-1!==n.indexOf("@")){const o=n.split("@")[1];e.bones[o]=e.bones[n],delete e.bones[n]}const i={format_version:"1.10",animations:{[n]:e}};Blockbench.export({type:"Bedrock Animation",extensions:["json"],name:o,content:JSON.stringify(i,null,2),savetype:"text"},(e=>{e&&Blockbench.showQuickMessage(`成功导出动画到 ${e}`)}))}()}});MenuBar.addAction(e,"tools")}()}})})();